/**
 * This file was auto-generated by Fern from our API Definition.
 */
package com.phenoml.api.resources.summary.requests;

import com.fasterxml.jackson.annotation.JsonAnyGetter;
import com.fasterxml.jackson.annotation.JsonAnySetter;
import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonInclude;
import com.fasterxml.jackson.annotation.JsonProperty;
import com.fasterxml.jackson.annotation.JsonSetter;
import com.fasterxml.jackson.annotation.JsonValue;
import com.fasterxml.jackson.annotation.Nulls;
import com.fasterxml.jackson.core.JsonParseException;
import com.fasterxml.jackson.core.JsonParser;
import com.fasterxml.jackson.databind.DeserializationContext;
import com.fasterxml.jackson.databind.annotation.JsonDeserialize;
import com.fasterxml.jackson.databind.deser.std.StdDeserializer;
import com.phenoml.api.core.ObjectMappers;
import com.phenoml.api.resources.summary.types.FhirBundle;
import com.phenoml.api.resources.summary.types.FhirResource;
import java.io.IOException;
import java.util.HashMap;
import java.util.Map;
import java.util.Objects;
import java.util.Optional;
import org.jetbrains.annotations.NotNull;

@JsonInclude(JsonInclude.Include.NON_ABSENT)
@JsonDeserialize(builder = CreateSummaryRequest.Builder.class)
public final class CreateSummaryRequest {
    private final Optional<Mode> mode;

    private final Optional<String> templateId;

    private final FhirResources fhirResources;

    private final Map<String, Object> additionalProperties;

    private CreateSummaryRequest(
            Optional<Mode> mode,
            Optional<String> templateId,
            FhirResources fhirResources,
            Map<String, Object> additionalProperties) {
        this.mode = mode;
        this.templateId = templateId;
        this.fhirResources = fhirResources;
        this.additionalProperties = additionalProperties;
    }

    /**
     * @return Summary generation mode:
     * <ul>
     * <li>narrative: Substitute FHIR data into a template (requires template_id)</li>
     * <li>flatten: Flatten FHIR resources for RAG/search (no template needed)</li>
     * <li>ips: Generate International Patient Summary (IPS) narrative per ISO 27269/HL7 FHIR IPS IG</li>
     * </ul>
     */
    @JsonProperty("mode")
    public Optional<Mode> getMode() {
        return mode;
    }

    /**
     * @return ID of the template to use (required for narrative mode)
     */
    @JsonProperty("template_id")
    public Optional<String> getTemplateId() {
        return templateId;
    }

    /**
     * @return FHIR resources (single resource or Bundle).
     * For IPS mode, must be a Bundle containing exactly one Patient resource with at least one
     * identifier (id, fullUrl, or identifier field). Returns an error if no Patient is found,
     * if multiple Patients are present, or if the Patient has no identifiers. Resources are
     * automatically filtered to only include those referencing the patient.
     */
    @JsonProperty("fhir_resources")
    public FhirResources getFhirResources() {
        return fhirResources;
    }

    @java.lang.Override
    public boolean equals(Object other) {
        if (this == other) return true;
        return other instanceof CreateSummaryRequest && equalTo((CreateSummaryRequest) other);
    }

    @JsonAnyGetter
    public Map<String, Object> getAdditionalProperties() {
        return this.additionalProperties;
    }

    private boolean equalTo(CreateSummaryRequest other) {
        return mode.equals(other.mode)
                && templateId.equals(other.templateId)
                && fhirResources.equals(other.fhirResources);
    }

    @java.lang.Override
    public int hashCode() {
        return Objects.hash(this.mode, this.templateId, this.fhirResources);
    }

    @java.lang.Override
    public String toString() {
        return ObjectMappers.stringify(this);
    }

    public static FhirResourcesStage builder() {
        return new Builder();
    }

    public interface FhirResourcesStage {
        /**
         * <p>FHIR resources (single resource or Bundle).
         * For IPS mode, must be a Bundle containing exactly one Patient resource with at least one
         * identifier (id, fullUrl, or identifier field). Returns an error if no Patient is found,
         * if multiple Patients are present, or if the Patient has no identifiers. Resources are
         * automatically filtered to only include those referencing the patient.</p>
         */
        _FinalStage fhirResources(@NotNull FhirResources fhirResources);

        Builder from(CreateSummaryRequest other);
    }

    public interface _FinalStage {
        CreateSummaryRequest build();

        /**
         * <p>Summary generation mode:</p>
         * <ul>
         * <li>narrative: Substitute FHIR data into a template (requires template_id)</li>
         * <li>flatten: Flatten FHIR resources for RAG/search (no template needed)</li>
         * <li>ips: Generate International Patient Summary (IPS) narrative per ISO 27269/HL7 FHIR IPS IG</li>
         * </ul>
         */
        _FinalStage mode(Optional<Mode> mode);

        _FinalStage mode(Mode mode);

        /**
         * <p>ID of the template to use (required for narrative mode)</p>
         */
        _FinalStage templateId(Optional<String> templateId);

        _FinalStage templateId(String templateId);
    }

    @JsonIgnoreProperties(ignoreUnknown = true)
    public static final class Builder implements FhirResourcesStage, _FinalStage {
        private FhirResources fhirResources;

        private Optional<String> templateId = Optional.empty();

        private Optional<Mode> mode = Optional.empty();

        @JsonAnySetter
        private Map<String, Object> additionalProperties = new HashMap<>();

        private Builder() {}

        @java.lang.Override
        public Builder from(CreateSummaryRequest other) {
            mode(other.getMode());
            templateId(other.getTemplateId());
            fhirResources(other.getFhirResources());
            return this;
        }

        /**
         * <p>FHIR resources (single resource or Bundle).
         * For IPS mode, must be a Bundle containing exactly one Patient resource with at least one
         * identifier (id, fullUrl, or identifier field). Returns an error if no Patient is found,
         * if multiple Patients are present, or if the Patient has no identifiers. Resources are
         * automatically filtered to only include those referencing the patient.</p>
         * <p>FHIR resources (single resource or Bundle).
         * For IPS mode, must be a Bundle containing exactly one Patient resource with at least one
         * identifier (id, fullUrl, or identifier field). Returns an error if no Patient is found,
         * if multiple Patients are present, or if the Patient has no identifiers. Resources are
         * automatically filtered to only include those referencing the patient.</p>
         * @return Reference to {@code this} so that method calls can be chained together.
         */
        @java.lang.Override
        @JsonSetter("fhir_resources")
        public _FinalStage fhirResources(@NotNull FhirResources fhirResources) {
            this.fhirResources = Objects.requireNonNull(fhirResources, "fhirResources must not be null");
            return this;
        }

        /**
         * <p>ID of the template to use (required for narrative mode)</p>
         * @return Reference to {@code this} so that method calls can be chained together.
         */
        @java.lang.Override
        public _FinalStage templateId(String templateId) {
            this.templateId = Optional.ofNullable(templateId);
            return this;
        }

        /**
         * <p>ID of the template to use (required for narrative mode)</p>
         */
        @java.lang.Override
        @JsonSetter(value = "template_id", nulls = Nulls.SKIP)
        public _FinalStage templateId(Optional<String> templateId) {
            this.templateId = templateId;
            return this;
        }

        /**
         * <p>Summary generation mode:</p>
         * <ul>
         * <li>narrative: Substitute FHIR data into a template (requires template_id)</li>
         * <li>flatten: Flatten FHIR resources for RAG/search (no template needed)</li>
         * <li>ips: Generate International Patient Summary (IPS) narrative per ISO 27269/HL7 FHIR IPS IG</li>
         * </ul>
         * @return Reference to {@code this} so that method calls can be chained together.
         */
        @java.lang.Override
        public _FinalStage mode(Mode mode) {
            this.mode = Optional.ofNullable(mode);
            return this;
        }

        /**
         * <p>Summary generation mode:</p>
         * <ul>
         * <li>narrative: Substitute FHIR data into a template (requires template_id)</li>
         * <li>flatten: Flatten FHIR resources for RAG/search (no template needed)</li>
         * <li>ips: Generate International Patient Summary (IPS) narrative per ISO 27269/HL7 FHIR IPS IG</li>
         * </ul>
         */
        @java.lang.Override
        @JsonSetter(value = "mode", nulls = Nulls.SKIP)
        public _FinalStage mode(Optional<Mode> mode) {
            this.mode = mode;
            return this;
        }

        @java.lang.Override
        public CreateSummaryRequest build() {
            return new CreateSummaryRequest(mode, templateId, fhirResources, additionalProperties);
        }
    }

    public static final class Mode {
        public static final Mode FLATTEN = new Mode(Value.FLATTEN, "flatten");

        public static final Mode NARRATIVE = new Mode(Value.NARRATIVE, "narrative");

        public static final Mode IPS = new Mode(Value.IPS, "ips");

        private final Value value;

        private final String string;

        Mode(Value value, String string) {
            this.value = value;
            this.string = string;
        }

        public Value getEnumValue() {
            return value;
        }

        @java.lang.Override
        @JsonValue
        public String toString() {
            return this.string;
        }

        @java.lang.Override
        public boolean equals(Object other) {
            return (this == other) || (other instanceof Mode && this.string.equals(((Mode) other).string));
        }

        @java.lang.Override
        public int hashCode() {
            return this.string.hashCode();
        }

        public <T> T visit(Visitor<T> visitor) {
            switch (value) {
                case FLATTEN:
                    return visitor.visitFlatten();
                case NARRATIVE:
                    return visitor.visitNarrative();
                case IPS:
                    return visitor.visitIps();
                case UNKNOWN:
                default:
                    return visitor.visitUnknown(string);
            }
        }

        @JsonCreator(mode = JsonCreator.Mode.DELEGATING)
        public static Mode valueOf(String value) {
            switch (value) {
                case "flatten":
                    return FLATTEN;
                case "narrative":
                    return NARRATIVE;
                case "ips":
                    return IPS;
                default:
                    return new Mode(Value.UNKNOWN, value);
            }
        }

        public enum Value {
            NARRATIVE,

            FLATTEN,

            IPS,

            UNKNOWN
        }

        public interface Visitor<T> {
            T visitNarrative();

            T visitFlatten();

            T visitIps();

            T visitUnknown(String unknownType);
        }
    }

    @JsonDeserialize(using = FhirResources.Deserializer.class)
    public static final class FhirResources {
        private final Object value;

        private final int type;

        private FhirResources(Object value, int type) {
            this.value = value;
            this.type = type;
        }

        @JsonValue
        public Object get() {
            return this.value;
        }

        @SuppressWarnings("unchecked")
        public <T> T visit(Visitor<T> visitor) {
            if (this.type == 0) {
                return visitor.visit((FhirResource) this.value);
            } else if (this.type == 1) {
                return visitor.visit((FhirBundle) this.value);
            }
            throw new IllegalStateException("Failed to visit value. This should never happen.");
        }

        @java.lang.Override
        public boolean equals(Object other) {
            if (this == other) return true;
            return other instanceof FhirResources && equalTo((FhirResources) other);
        }

        private boolean equalTo(FhirResources other) {
            return value.equals(other.value);
        }

        @java.lang.Override
        public int hashCode() {
            return Objects.hash(this.value);
        }

        @java.lang.Override
        public String toString() {
            return this.value.toString();
        }

        public static FhirResources of(FhirResource value) {
            return new FhirResources(value, 0);
        }

        public static FhirResources of(FhirBundle value) {
            return new FhirResources(value, 1);
        }

        public interface Visitor<T> {
            T visit(FhirResource value);

            T visit(FhirBundle value);
        }

        static final class Deserializer extends StdDeserializer<FhirResources> {
            Deserializer() {
                super(FhirResources.class);
            }

            @java.lang.Override
            public FhirResources deserialize(JsonParser p, DeserializationContext context) throws IOException {
                Object value = p.readValueAs(Object.class);
                try {
                    return of(ObjectMappers.JSON_MAPPER.convertValue(value, FhirResource.class));
                } catch (RuntimeException e) {
                }
                try {
                    return of(ObjectMappers.JSON_MAPPER.convertValue(value, FhirBundle.class));
                } catch (RuntimeException e) {
                }
                throw new JsonParseException(p, "Failed to deserialize");
            }
        }
    }
}
